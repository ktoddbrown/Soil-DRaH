<!DOCTYPE html>
<!-- saved from url=(0022)http://localhost:6116/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>How-to Annotations</title>
<style class="anchorjs"></style><style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="./How-to Annotations HTML_files/clipboard.min.js.download"></script>
<script src="./How-to Annotations HTML_files/quarto.js.download"></script>
<script src="./How-to Annotations HTML_files/popper.min.js.download"></script>
<script src="./How-to Annotations HTML_files/tippy.umd.min.js.download"></script>
<script src="./How-to Annotations HTML_files/anchor.min.js.download"></script>
<link href="./How-to Annotations HTML_files/tippy.css" rel="stylesheet">
<link href="./How-to Annotations HTML_files/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="./How-to Annotations HTML_files/bootstrap.min.js.download"></script>
<link href="./How-to Annotations HTML_files/bootstrap-icons.css" rel="stylesheet">
<link href="./How-to Annotations HTML_files/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="./How-to Annotations HTML_files/kePrint.js.download"></script>

<link href="./How-to Annotations HTML_files/lightable.css" rel="stylesheet">



<style>.ansi-display{font-family:monospace;white-space:pre-wrap;--ansiBlack: #000000;--ansiRed: #cd3131;--ansiGreen: #00BC00;--ansiYellow: #949800;--ansiBlue: #0451a5;--ansiMagenta: #bc05bc;--ansiCyan: #0598bc;--ansiWhite: #555555;--ansiBrightBlack: #666666;--ansiBrightRed: #cd3131;--ansiBrightGreen: #14CE14;--ansiBrightYellow: #b5ba00;--ansiBrightBlue: #0451a5;--ansiBrightMagenta: #bc05bc;--ansiBrightCyan: #0598bc;--ansiBrightWhite: #a5a5a5}.dark-mode .ansi-display{--ansiBlack: #000000;--ansiRed: #cd3131;--ansiGreen: #0DBC79;--ansiYellow: #e5e510;--ansiBlue: #2472c8;--ansiMagenta: #bc3fbc;--ansiCyan: #11a8cd;--ansiWhite: #e5e5e5;--ansiBrightBlack: #666666;--ansiBrightRed: #f14c4c;--ansiBrightGreen: #23d18b;--ansiBrightYellow: #f5f543;--ansiBrightBlue: #3b8eea;--ansiBrightMagenta: #d670d6;--ansiBrightCyan: #29b8db;--ansiBrightWhite: #e5e5e5}@keyframes ansi-displaly-run-blink{50%{opacity:0}}.fui-FluentProvider h2{border-bottom:none;padding-bottom:0}</style><style data-make-styles-bucket="d" data-priority="0"></style><style id="fui-FluentProviderr0"></style></head>

<body class="quarto-light" data-tabster="{&quot;root&quot;:{}}">

<i tabindex="0" role="none" data-tabster-dummy="" aria-hidden="true" style="position: fixed; height: 1px; width: 1px; opacity: 0.001; z-index: -1; content-visibility: hidden; top: 0px; left: 0px;"></i><div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">How-to Annotations</h1>
</div>



<div class="quarto-title-meta column-page">

    
  
    
  </div>
  


</header>


<section id="purpose" class="level2">
<h2 class="anchored" data-anchor-id="purpose">Purpose<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#purpose" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>
<section id="what-are-annotations-and-why-are-they-important" class="level4">
<h4 class="anchored" data-anchor-id="what-are-annotations-and-why-are-they-important"><em>What are annotations and why are they important?</em><a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#what-are-annotations-and-why-are-they-important" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>
<p>Annotations, or metadata, refers to information about the data. This can include long names or descriptions of columns, units associated with those columns, control vocabularies, or methods. Sometimes this also includes context that is applicable to the entire dataset that would be known within the original publication but might be lost when moving the data out of that context. Sample time, location or soil type are examples of data that is often in methods sections or introductions of a report or publication rather then inside a data table, that may be lost when that data is integrated into a larger collection.</p>
</section>
</section>
<section id="annotations-tuple-structure" class="level2">
<h2 class="anchored" data-anchor-id="annotations-tuple-structure">Annotations Tuple Structure<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#annotations-tuple-structure" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>
<section id="what-does-the-data-annotations-tuple-structure-look-like" class="level4">
<h4 class="anchored" data-anchor-id="what-does-the-data-annotations-tuple-structure-look-like"><em>What does the data annotations tuple structure look like?</em><a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#what-does-the-data-annotations-tuple-structure-look-like" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>
<p>While there are many forms that an annotation can take we have settled on a 4 part tuple: (<code>id</code>, <code>of_variable</code>, <code>is_type</code>, <code>with_entry</code>) An id are the column identifiers and often consists of a <code>table_id</code> and a <code>column_id</code>. The <code>table_id</code> is generally the base name of the csv/tsv file that is associated with the <code>column_id</code>, which is an exact match for the names of the columns in the associated tables. All <code>column_id</code> must be associated with a <code>table_id</code> but information may be associated with a <code>table_id</code> and not a specific column (i.e., you have metadata that applies to the whole or groups of the data set and not just a specific column).</p>
<p>Entries in the <code>of_variable</code> column describe the variables that is associated with the <code>id</code>. These are generally observable properties like bulk density, organic carbon, ecotype, or soil color. Often these represent how the researcher sees their data, for example do they distinguish between organic carbon fraction and carbon fraction. In creating these annotations you should strive to reflect the original purpose or intent of the data providers as much as possible. In context to the highly data set dependent <code>of_variable</code> entries, <code>is_type</code> should have a more restricted set of entries.</p>
<p>The <code>is_type</code> entry commonly falls into one of the following {<code>value</code>, <code>definition</code>, <code>unit</code>, <code>method</code>, <code>control_vocabulary</code>}. This describes the kind of information associated with <code>of_variable</code> that is found in the <code>with_entry</code>. Note that we have chosen not to distinguish between numerical or text values, and instead just use the term ‘value’ for simplicity. Currently <code>control_vocabularies</code> are key-definition pairs where <code>|</code> separate the key and definition and <code>;</code> separate the different keys.</p>
<p>The <code>with_entry</code> column is either the entry associated with the variable and type described above or a special notation that indicates you should refer to the data set being described. We currently use <code>--</code> for data set reference.</p>
</section>
</section>
<section id="annotations-outline" class="level2">
<h2 class="anchored" data-anchor-id="annotations-outline">Annotations Outline<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#annotations-outline" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>
<section id="at-a-high-level-what-is-the-data-annotations-generation-process" class="level4">
<h4 class="anchored" data-anchor-id="at-a-high-level-what-is-the-data-annotations-generation-process"><em>At a high-level, what is the data annotations generation process?</em><a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#at-a-high-level-what-is-the-data-annotations-generation-process" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>
<p>Gathering the information to create an annotation requires reading the contextual information provided with the data. This can include reading associated publications or reports, reviewing metadata on archives, or talking with a point of contact familiar with the data. Documentation resources will generally fall into structured machine readable formats (i.e., EML metadata on an archive), unstructured machine readable (i.e., text tables or structured lists in pdf documents), and human driven (i.e., paragraph embedded information or correspondence with other researchers). While it is possible to create an annotation entirely by hand, often times text processing scripts can help reduce errors when working with machine readable text. If you do use text processing, documenting that text processing at the end of a integration report is good practice to ensure transparency. In all cases, running checks on your data annotation structure (described below) will reduce frustrations down the line.</p>
<p>Generally you are looking to identify human readable descriptions of what the columns names refer to, associated units or methods, location, collection time information, and control vocabulary.</p>
<p>As a final step annotations should be checked for completeness. Column and table id should be cross referenced with the data set itself to ensure that all columns are described as desired (for large data sets, a partial annotation of only desired may be appropriate). Variables and types should be checked for spelling errors (for example the <code>unique</code> function in R can be used to check for spelling variations).</p>
<p>Finally reviewing the annotations table with an expert in the data set or second reviewer is recommended at this stage.</p>
</section>
</section>
<section id="annotations-of-data-annotations" class="level2">
<h2 class="anchored" data-anchor-id="annotations-of-data-annotations">Annotations of Data Annotations<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#annotations-of-data-annotations" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>
<section id="what-does-a-complete-annotations-table-look-like" class="level4">
<h4 class="anchored" data-anchor-id="what-does-a-complete-annotations-table-look-like"><em>What does a complete annotations table look like?</em><a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#what-does-a-complete-annotations-table-look-like" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>
<p>To give an example of what a finished annotations looks like, consider the annotation table below which encapsulates important context behind the annotations themselves as described in the <code>Annotations Tuple Structure</code> section.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th><code>table_id</code></th>
<th><code>column_id</code></th>
<th><code>of_variable</code></th>
<th><code>is_type</code></th>
<th><code>with_entry</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>annotations_df</td>
<td>column_id</td>
<td>column_header</td>
<td>identifier</td>
<td>–</td>
</tr>
<tr class="even">
<td>annotations_df</td>
<td>column_id</td>
<td>column_header</td>
<td>description</td>
<td>The column name or header or identifier that links to the table being annotated.</td>
</tr>
<tr class="odd">
<td>annotations_df</td>
<td>of_variable</td>
<td>variable</td>
<td>value</td>
<td>–</td>
</tr>
<tr class="even">
<td>annotations_df</td>
<td>of_variable</td>
<td>variable</td>
<td>description</td>
<td>The property or variable that the information in this column is associated with.</td>
</tr>
<tr class="odd">
<td>annotations_df</td>
<td>is_type</td>
<td>type</td>
<td>value</td>
<td>–</td>
</tr>
<tr class="even">
<td>annotations_df</td>
<td>is_type</td>
<td>type</td>
<td>description</td>
<td>The dimension or type of information associated with a specific variable and column</td>
</tr>
<tr class="odd">
<td>annotations_df</td>
<td>is_type</td>
<td>type</td>
<td>control_vocabulary</td>
<td>‘value|the observation or measurement; definition|a human readable definition of the variable; unit|unit of measure for the observation; control_vocabulary|paired term definitions used to describe the variable’</td>
</tr>
<tr class="even">
<td>annotations_df</td>
<td>with_entry</td>
<td>entry</td>
<td>value</td>
<td>–</td>
</tr>
<tr class="odd">
<td>annotations_df</td>
<td>with_entry</td>
<td>entry</td>
<td>description</td>
<td>the entry associated with the id-variable-type tuple or a ‘–’ to denote reference to the data table being annotated</td>
</tr>
</tbody>
</table>
<p>Notice how the <code>column_id</code> and <code>of_varaible</code> entries (originally variables) are not all unique. The entires column_id, of_variable, and with_entry appear twice while is_type appears three times – that is intentional and how your annotations table should turn out if structured properly. In general, the number of entries for any given variable in your data annotations table is equal to the number of is_type-with_entry pairs you need. This table could be saved as a CSV file (or other delimited file type) for future use in a read function which are explained in another part of the Wiki.</p>
</section>
</section>
<section id="simple-example" class="level2">
<h2 class="anchored" data-anchor-id="simple-example">Simple Example<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#simple-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>
<section id="what-does-the-process-look-like-from-start-to-finish-on-an-example" class="level4">
<h4 class="anchored" data-anchor-id="what-does-the-process-look-like-from-start-to-finish-on-an-example"><em>What does the process look like from start to finish on an example?</em><a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#what-does-the-process-look-like-from-start-to-finish-on-an-example" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h4>
<p>To begin, load in the following libraries to be able to successfully run the R code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="http://localhost:6116/#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Used to make the data frames display in an organzied manner</span></span>
<span id="cb1-2"><a href="http://localhost:6116/#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-3"><a href="http://localhost:6116/#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-4"><a href="http://localhost:6116/#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Used to modify the data frame in a streamlined fashion</span></span>
<span id="cb1-5"><a href="http://localhost:6116/#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="http://localhost:6116/#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Used to parse strings</span></span>
<span id="cb1-7"><a href="http://localhost:6116/#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-data-set" class="level3">
<h3 class="anchored" data-anchor-id="the-data-set">The Data Set<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#the-data-set" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>
<p>Your data set may be stored as a CSV file, a Excel spreadsheet, or in some other form. Regardless you must be able to read it into a R script for processing. You can use the <code>read_csv</code> function (from the readr library) or the <code>read_excel</code> function (from the readxl library) to read in such aforementioned files.</p>
<p>For this example, let’s say you read in the following data from a file called Salary Survey.csv of a survey given to 10 people asking basic information about them.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="http://localhost:6116/#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly generated data for the example that follows</span></span>
<span id="cb2-2"><a href="http://localhost:6116/#cb2-2" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Name of participant"</span>, <span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>, <span class="st">"Mary"</span>, <span class="st">"Sam"</span>, <span class="st">"Jack"</span>, <span class="st">"Sue"</span>, <span class="st">"Tom"</span>, <span class="st">"Jon"</span>, <span class="st">"Harry"</span>)</span>
<span id="cb2-3"><a href="http://localhost:6116/#cb2-3" aria-hidden="true" tabindex="-1"></a>participant_id <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Uniquie identifer for a participant"</span>, <span class="dv">12</span>, <span class="dv">42</span>, <span class="dv">15</span>, <span class="dv">78</span>, <span class="dv">32</span>, <span class="dv">22</span>, <span class="dv">90</span>, <span class="dv">65</span>, <span class="dv">15</span>, <span class="dv">10</span>)</span>
<span id="cb2-4"><a href="http://localhost:6116/#cb2-4" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Age of participant"</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">45</span>, <span class="dv">46</span>, <span class="dv">71</span>, <span class="dv">28</span>, <span class="dv">67</span>, <span class="dv">45</span>, <span class="dv">50</span>)</span>
<span id="cb2-5"><a href="http://localhost:6116/#cb2-5" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Annual salary of participant (Thousands of US dollars)"</span>, <span class="dv">90</span>, <span class="dv">85</span>, <span class="dv">88</span>, <span class="dv">66</span>, <span class="dv">59</span>, <span class="dv">103</span>, <span class="dv">77</span>, <span class="dv">54</span>, <span class="dv">31</span>, <span class="dv">55</span>)</span>
<span id="cb2-6"><a href="http://localhost:6116/#cb2-6" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"State participant currently lives in: FL = Florida, AZ = Arizona, CA = Califorina, NY = New York, WY = Wyoming, NM = New Mexico, KY = Kentucky"</span>, <span class="st">"FL"</span>, <span class="st">"AZ"</span>, <span class="st">"CA"</span>, <span class="st">"NY"</span>, <span class="st">"WY"</span>, <span class="st">"FL"</span>, <span class="st">"FL"</span>, <span class="st">"NY"</span>, <span class="st">"NM"</span>, <span class="st">"KY"</span>)</span>
<span id="cb2-7"><a href="http://localhost:6116/#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="http://localhost:6116/#cb2-8" aria-hidden="true" tabindex="-1"></a>survey_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Name =</span> names, <span class="at">Participant_ID =</span> participant_id, <span class="at">Age =</span> ages, <span class="at">Salary =</span> salary, <span class="at">State =</span> state)</span>
<span id="cb2-9"><a href="http://localhost:6116/#cb2-9" aria-hidden="true" tabindex="-1"></a>survey_note <span class="ot">=</span> <span class="st">"This data was randomly generated in 2024"</span></span>
<span id="cb2-10"><a href="http://localhost:6116/#cb2-10" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">=</span> <span class="st">"Salary Survey"</span></span>
<span id="cb2-11"><a href="http://localhost:6116/#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="http://localhost:6116/#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Function we'll use to display the any df; going forward, this will not be shown </span></span>
<span id="cb2-13"><a href="http://localhost:6116/#cb2-13" aria-hidden="true" tabindex="-1"></a>display_df <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb2-14"><a href="http://localhost:6116/#cb2-14" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(df) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="http://localhost:6116/#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="st">"striped"</span>)</span>
<span id="cb2-16"><a href="http://localhost:6116/#cb2-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-17"><a href="http://localhost:6116/#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="http://localhost:6116/#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">display_df</span>(survey_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Participant_ID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Age</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Salary</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name of participant</td>
<td style="text-align: left;">Uniquie identifer for a participant</td>
<td style="text-align: left;">Age of participant</td>
<td style="text-align: left;">Annual salary of participant (Thousands of US dollars)</td>
<td style="text-align: left;">State participant currently lives in: FL = Florida, AZ = Arizona, CA = Califorina, NY = New York, WY = Wyoming, NM = New Mexico, KY = Kentucky</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alice</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">90</td>
<td style="text-align: left;">FL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bob</td>
<td style="text-align: left;">42</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">85</td>
<td style="text-align: left;">AZ</td>
</tr>
<tr class="even">
<td style="text-align: left;">Charlie</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">35</td>
<td style="text-align: left;">88</td>
<td style="text-align: left;">CA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mary</td>
<td style="text-align: left;">78</td>
<td style="text-align: left;">45</td>
<td style="text-align: left;">66</td>
<td style="text-align: left;">NY</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sam</td>
<td style="text-align: left;">32</td>
<td style="text-align: left;">46</td>
<td style="text-align: left;">59</td>
<td style="text-align: left;">WY</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jack</td>
<td style="text-align: left;">22</td>
<td style="text-align: left;">71</td>
<td style="text-align: left;">103</td>
<td style="text-align: left;">FL</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sue</td>
<td style="text-align: left;">90</td>
<td style="text-align: left;">28</td>
<td style="text-align: left;">77</td>
<td style="text-align: left;">FL</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tom</td>
<td style="text-align: left;">65</td>
<td style="text-align: left;">67</td>
<td style="text-align: left;">54</td>
<td style="text-align: left;">NY</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jon</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">45</td>
<td style="text-align: left;">31</td>
<td style="text-align: left;">NM</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Harry</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">55</td>
<td style="text-align: left;">KY</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The metadata is in the first row of every column. It gives context as to what each variable (Name, Age, State, etc.) means. The data is in the remaining rows. If, as we analyze this data set, we do not take into account the context provided by the metadata, the data itself could be misunderstood or futile. Is the salary that’s reported weekly and in hundreds of dollars – or is it yearly and in thousands of dollars? What is this seemingly random number assigned to each participant used for? Fortunately, these type of questions are answered by the metadata – making any future analysis of the data useful and appropriate. And so, it is important that we parse then transform it into the appropriate tuple structure and store it.</p>
</section>
<section id="reading-in-metadata-for-use" class="level3">
<h3 class="anchored" data-anchor-id="reading-in-metadata-for-use">Reading In Metadata for Use<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#reading-in-metadata-for-use" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>
<p>Data sets come in varying formats – with some being easier than others to acquire information from. And while there are too many formats to count, we will work with the one above as it is fairly common. Regardless of the data set format, the end goal of getting the metadata into the tuple structure is the always same.</p>
<p>First, we start our annotations df by getting all of the variables from the original data set and putting them under the column_id column. Note: there will be only one instance of each variable for right now; we will take into account multiple instances for each is_type-with_entry pair later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="http://localhost:6116/#cb3-1" aria-hidden="true" tabindex="-1"></a>annotations <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">colnames</span>(survey_df))</span>
<span id="cb3-2"><a href="http://localhost:6116/#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(annotations)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"column_id"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">column_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
</tr>
<tr class="even">
<td style="text-align: left;">Participant_ID</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary</td>
</tr>
<tr class="odd">
<td style="text-align: left;">State</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>We will go ahead and add the <code>table_id</code> and <code>of_variable</code> column. We will worry about the order of the columns after every column has been added.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="http://localhost:6116/#cb4-1" aria-hidden="true" tabindex="-1"></a>annotations <span class="ot">&lt;-</span> annotations <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="http://localhost:6116/#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-3"><a href="http://localhost:6116/#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Setting the table_id column entires to the file name that stored the data table</span></span>
<span id="cb4-4"><a href="http://localhost:6116/#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">table_id =</span> file_name,</span>
<span id="cb4-5"><a href="http://localhost:6116/#cb4-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-6"><a href="http://localhost:6116/#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mapping variables to the appropriate of_variable entry</span></span>
<span id="cb4-7"><a href="http://localhost:6116/#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">of_variable =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-8"><a href="http://localhost:6116/#cb4-8" aria-hidden="true" tabindex="-1"></a>      column_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Name"</span>) <span class="sc">~</span> <span class="st">"Person_Name"</span>,</span>
<span id="cb4-9"><a href="http://localhost:6116/#cb4-9" aria-hidden="true" tabindex="-1"></a>      column_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Participant_ID"</span>) <span class="sc">~</span> <span class="st">"Unique_ID"</span>,</span>
<span id="cb4-10"><a href="http://localhost:6116/#cb4-10" aria-hidden="true" tabindex="-1"></a>      column_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Age"</span>) <span class="sc">~</span> <span class="st">"Person_Age"</span>,</span>
<span id="cb4-11"><a href="http://localhost:6116/#cb4-11" aria-hidden="true" tabindex="-1"></a>      column_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Salary"</span>) <span class="sc">~</span> <span class="st">"Annual_Salary"</span>,</span>
<span id="cb4-12"><a href="http://localhost:6116/#cb4-12" aria-hidden="true" tabindex="-1"></a>      column_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"State"</span>) <span class="sc">~</span> <span class="st">"State_Located"</span>,</span>
<span id="cb4-13"><a href="http://localhost:6116/#cb4-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-14"><a href="http://localhost:6116/#cb4-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">column_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">table_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">of_variable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Person_Name</td>
</tr>
<tr class="even">
<td style="text-align: left;">Participant_ID</td>
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Unique_ID</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Person_Age</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary</td>
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Annual_Salary</td>
</tr>
<tr class="odd">
<td style="text-align: left;">State</td>
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">State_Located</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="getting-is_type-with_entry-pairs" class="level3">
<h3 class="anchored" data-anchor-id="getting-is_type-with_entry-pairs">Getting is_type-with_entry Pairs<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#getting-is_type-with_entry-pairs" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>
<p>Next, we’ll aim to add the is_type-with_entry pairs. At first, they will be appended in a differenet structure than that of the tuple format; we’ll fixed that later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="http://localhost:6116/#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse the metadata about the State and Salary variables into their appropriate is_type type.</span></span>
<span id="cb5-2"><a href="http://localhost:6116/#cb5-2" aria-hidden="true" tabindex="-1"></a>state_cv <span class="ot">=</span> <span class="fu">str_extract</span>(survey_df[<span class="dv">1</span>, <span class="fu">which</span>(<span class="fu">colnames</span>(survey_df) <span class="sc">==</span> <span class="st">"State"</span>)], stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"(?&lt;=: ).*"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="http://localhost:6116/#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">FIXME</span><span class="co">:`|` appears as &amp;#124; when kable table is rendered and shown.</span></span>
<span id="cb5-4"><a href="http://localhost:6116/#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">" = "</span>, <span class="st">"|"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="http://localhost:6116/#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">","</span>, <span class="st">";"</span>)</span>
<span id="cb5-6"><a href="http://localhost:6116/#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="http://localhost:6116/#cb5-7" aria-hidden="true" tabindex="-1"></a>state_desc <span class="ot">=</span> <span class="fu">str_extract</span>(survey_df[<span class="dv">1</span>, <span class="fu">which</span>(<span class="fu">colnames</span>(survey_df) <span class="sc">==</span> <span class="st">"State"</span>)], stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">".*(?=:)"</span>))</span>
<span id="cb5-8"><a href="http://localhost:6116/#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="http://localhost:6116/#cb5-9" aria-hidden="true" tabindex="-1"></a>salary_unit <span class="ot">=</span> <span class="fu">str_extract</span>(survey_df[<span class="dv">1</span>, <span class="fu">which</span>(<span class="fu">colnames</span>(survey_df) <span class="sc">==</span> <span class="st">"Salary"</span>)], stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">().*?(?=</span><span class="sc">\\</span><span class="st">))"</span>))</span>
<span id="cb5-10"><a href="http://localhost:6116/#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="http://localhost:6116/#cb5-11" aria-hidden="true" tabindex="-1"></a>salary_desc <span class="ot">=</span> <span class="fu">str_extract</span>(survey_df[<span class="dv">1</span>, <span class="fu">which</span>(<span class="fu">colnames</span>(survey_df) <span class="sc">==</span> <span class="st">"Salary"</span>)], stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">".*(?=</span><span class="sc">\\</span><span class="st">()"</span>))</span>
<span id="cb5-12"><a href="http://localhost:6116/#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="http://localhost:6116/#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the annotations df to include all is_type-with_entry pairs</span></span>
<span id="cb5-14"><a href="http://localhost:6116/#cb5-14" aria-hidden="true" tabindex="-1"></a>annotations <span class="ot">&lt;-</span> annotations <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="http://localhost:6116/#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-16"><a href="http://localhost:6116/#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="st">"--"</span>,</span>
<span id="cb5-17"><a href="http://localhost:6116/#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">identifier =</span> <span class="st">"--"</span>,</span>
<span id="cb5-18"><a href="http://localhost:6116/#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> <span class="fu">c</span>(survey_df[<span class="dv">1</span>,]),</span>
<span id="cb5-19"><a href="http://localhost:6116/#cb5-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-20"><a href="http://localhost:6116/#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-21"><a href="http://localhost:6116/#cb5-21" aria-hidden="true" tabindex="-1"></a>      column_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"State"</span>) <span class="sc">~</span> state_desc,</span>
<span id="cb5-22"><a href="http://localhost:6116/#cb5-22" aria-hidden="true" tabindex="-1"></a>      column_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Salary"</span>) <span class="sc">~</span> salary_desc,</span>
<span id="cb5-23"><a href="http://localhost:6116/#cb5-23" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(description)</span>
<span id="cb5-24"><a href="http://localhost:6116/#cb5-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-25"><a href="http://localhost:6116/#cb5-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-26"><a href="http://localhost:6116/#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">control_vocabulary =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-27"><a href="http://localhost:6116/#cb5-27" aria-hidden="true" tabindex="-1"></a>      column_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"State"</span>) <span class="sc">~</span> state_cv,</span>
<span id="cb5-28"><a href="http://localhost:6116/#cb5-28" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb5-29"><a href="http://localhost:6116/#cb5-29" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-30"><a href="http://localhost:6116/#cb5-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-31"><a href="http://localhost:6116/#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">unit =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-32"><a href="http://localhost:6116/#cb5-32" aria-hidden="true" tabindex="-1"></a>      column_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Salary"</span>) <span class="sc">~</span> salary_unit,</span>
<span id="cb5-33"><a href="http://localhost:6116/#cb5-33" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb5-34"><a href="http://localhost:6116/#cb5-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-35"><a href="http://localhost:6116/#cb5-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">column_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">table_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">of_variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">value</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">identifier</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">description</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">control_vocabulary</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Person_Name</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">Name of participant</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Participant_ID</td>
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Unique_ID</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">Uniquie identifer for a participant</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Person_Age</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">Age of participant</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary</td>
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Annual_Salary</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">Annual salary of participant</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Thousands of US dollars</td>
</tr>
<tr class="odd">
<td style="text-align: left;">State</td>
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">State_Located</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">--</td>
<td style="text-align: left;">State participant currently lives in</td>
<td style="text-align: left;">FL&amp;#124;Florida; AZ&amp;#124;Arizona; CA&amp;#124;Califorina; NY&amp;#124;New York; WY&amp;#124;Wyoming; NM&amp;#124;New Mexico; KY&amp;#124;Kentucky</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>We will now correct the order of the columns and then pivot the annotations df into the correct tuple format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="http://localhost:6116/#cb6-1" aria-hidden="true" tabindex="-1"></a>annotations <span class="ot">&lt;-</span> annotations <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="http://localhost:6116/#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the columns in the correct order</span></span>
<span id="cb6-3"><a href="http://localhost:6116/#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(table_id, column_id, of_variable, value, description, unit, control_vocabulary, identifier) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="http://localhost:6116/#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot the annotations df into the correct format for the tuples and drop any rows with NA values</span></span>
<span id="cb6-5"><a href="http://localhost:6116/#cb6-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">"value"</span>, <span class="st">"description"</span>, <span class="st">"unit"</span>, <span class="st">"control_vocabulary"</span>, <span class="st">"identifier"</span>), <span class="at">names_to =</span> <span class="st">"is_type"</span>, <span class="at">values_to =</span> <span class="st">"with_entry"</span>, <span class="at">values_drop_na=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">table_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">column_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">of_variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">is_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">with_entry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Person_Name</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Person_Name</td>
<td style="text-align: left;">description</td>
<td style="text-align: left;">Name of participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Person_Name</td>
<td style="text-align: left;">identifier</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Participant_ID</td>
<td style="text-align: left;">Unique_ID</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Participant_ID</td>
<td style="text-align: left;">Unique_ID</td>
<td style="text-align: left;">description</td>
<td style="text-align: left;">Uniquie identifer for a participant</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Participant_ID</td>
<td style="text-align: left;">Unique_ID</td>
<td style="text-align: left;">identifier</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Person_Age</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Person_Age</td>
<td style="text-align: left;">description</td>
<td style="text-align: left;">Age of participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Person_Age</td>
<td style="text-align: left;">identifier</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Salary</td>
<td style="text-align: left;">Annual_Salary</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Salary</td>
<td style="text-align: left;">Annual_Salary</td>
<td style="text-align: left;">description</td>
<td style="text-align: left;">Annual salary of participant</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Salary</td>
<td style="text-align: left;">Annual_Salary</td>
<td style="text-align: left;">unit</td>
<td style="text-align: left;">Thousands of US dollars</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Salary</td>
<td style="text-align: left;">Annual_Salary</td>
<td style="text-align: left;">identifier</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">State</td>
<td style="text-align: left;">State_Located</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">State</td>
<td style="text-align: left;">State_Located</td>
<td style="text-align: left;">description</td>
<td style="text-align: left;">State participant currently lives in</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">State</td>
<td style="text-align: left;">State_Located</td>
<td style="text-align: left;">control_vocabulary</td>
<td style="text-align: left;">FL&amp;#124;Florida; AZ&amp;#124;Arizona; CA&amp;#124;Califorina; NY&amp;#124;New York; WY&amp;#124;Wyoming; NM&amp;#124;New Mexico; KY&amp;#124;Kentucky</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">State</td>
<td style="text-align: left;">State_Located</td>
<td style="text-align: left;">identifier</td>
<td style="text-align: left;">--</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Notice how we now have the same entries for column_id/of_variable repeating the number of is_type-with_entry pairs times. We almost have a complete annotations df.</p>
</section>
<section id="finishing-touches" class="level3">
<h3 class="anchored" data-anchor-id="finishing-touches">Finishing Touches<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#finishing-touches" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h3>
<p>Before we can save this data annotation df to a CSV file we must add table-wide descriptions, that is information that applies to the whole annotations df and not just a particular variable. In this example, we have a table note.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="http://localhost:6116/#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># column_id and of_variable are set to NA for table-wide descriptions</span></span>
<span id="cb7-2"><a href="http://localhost:6116/#cb7-2" aria-hidden="true" tabindex="-1"></a>annotations <span class="ot">&lt;-</span> annotations <span class="sc">%&gt;%</span> <span class="fu">add_row</span>(<span class="at">table_id=</span>file_name, <span class="at">column_id=</span><span class="cn">NA</span>, <span class="at">of_variable=</span><span class="cn">NA</span>, <span class="at">is_type=</span><span class="st">"note"</span>, <span class="at">with_entry=</span>survey_note, <span class="at">.before=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">table_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">column_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">of_variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">is_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">with_entry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">note</td>
<td style="text-align: left;">This data was randomly generated in 2024</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Person_Name</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Person_Name</td>
<td style="text-align: left;">description</td>
<td style="text-align: left;">Name of participant</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Name</td>
<td style="text-align: left;">Person_Name</td>
<td style="text-align: left;">identifier</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Participant_ID</td>
<td style="text-align: left;">Unique_ID</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Participant_ID</td>
<td style="text-align: left;">Unique_ID</td>
<td style="text-align: left;">description</td>
<td style="text-align: left;">Uniquie identifer for a participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Participant_ID</td>
<td style="text-align: left;">Unique_ID</td>
<td style="text-align: left;">identifier</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Person_Age</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Person_Age</td>
<td style="text-align: left;">description</td>
<td style="text-align: left;">Age of participant</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Person_Age</td>
<td style="text-align: left;">identifier</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Salary</td>
<td style="text-align: left;">Annual_Salary</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Salary</td>
<td style="text-align: left;">Annual_Salary</td>
<td style="text-align: left;">description</td>
<td style="text-align: left;">Annual salary of participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Salary</td>
<td style="text-align: left;">Annual_Salary</td>
<td style="text-align: left;">unit</td>
<td style="text-align: left;">Thousands of US dollars</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">Salary</td>
<td style="text-align: left;">Annual_Salary</td>
<td style="text-align: left;">identifier</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">State</td>
<td style="text-align: left;">State_Located</td>
<td style="text-align: left;">value</td>
<td style="text-align: left;">--</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">State</td>
<td style="text-align: left;">State_Located</td>
<td style="text-align: left;">description</td>
<td style="text-align: left;">State participant currently lives in</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">State</td>
<td style="text-align: left;">State_Located</td>
<td style="text-align: left;">control_vocabulary</td>
<td style="text-align: left;">FL&amp;#124;Florida; AZ&amp;#124;Arizona; CA&amp;#124;Califorina; NY&amp;#124;New York; WY&amp;#124;Wyoming; NM&amp;#124;New Mexico; KY&amp;#124;Kentucky</td>
</tr>
<tr class="even">
<td style="text-align: left;">Salary Survey</td>
<td style="text-align: left;">State</td>
<td style="text-align: left;">State_Located</td>
<td style="text-align: left;">identifier</td>
<td style="text-align: left;">--</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>We will now save this annotation df for future use (in the read functions which are, as mentioned before, explained in another part of the Wiki).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="http://localhost:6116/#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(annotations, <span class="st">"Salary Survey Annotations.csv"</span>, <span class="at">quote=</span><span class="cn">FALSE</span>, <span class="at">row.names=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="larger-data-set-annotations" class="level2">
<h2 class="anchored" data-anchor-id="larger-data-set-annotations">Larger Data Set Annotations<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#larger-data-set-annotations" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>
<p><em>What does the data generation process look like on a larger, more realistic data set?</em></p>
<p>This data was pulled from the Forest Inventory and Analysis Database (wo-fiadb_user_guide_p2_9-1_final.pdf variable stores the link to the pdf where the data was gathered: <a href="https://research.fs.usda.gov/sites/default/files/2023-11/wo-fiadb_user_guide_p2_9-1_final.pdf" class="uri">https://research.fs.usda.gov/sites/default/files/2023-11/wo-fiadb_user_guide_p2_9-1_final.pdf</a>).</p>
<p>Below is the R code which produces the data annotations.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>## Purpose

Like many large databases the FIADB has existing documentation with valuable metadata in it that we would like to capture for our data annotations.
Unfortunately it is locked up as a PDF document and not in a JSON or similar format.
This document walks through recovering some of that information for our data annotations.
Initially the data annotations table was compiled by colleagues at the Forest Service so this is only a partial recovery and is meant to be an example of how you can use `R`'s `pdftools` library and regular expression processes to generate some of the metadata.

```{r }
stop('this should not execute')
#Burrill, Elizabeth A.; DiTommaso, Andrea M.; Turner, Jeffery A.; Pugh, Scott A.; Menlove, James; Christensen, Glenn; Perry, Carol J.; Conkling, Barbara L. 2023. The Forest Inventory and Analysis Database: database description and user guide version 9.1 for Phase 2. U.S. Department of Agriculture, Forest Service. 1066 p. [Online]. Available at web address: https://www.fia.fs.usda.gov/library/database-documentation/index.

dataDictionary_pdf &lt;- file.path(dataDir, 'wo-fiadb_user_guide_p2_9-1_final.pdf')

#also refer to 
#Forest Inventory and Analysis. 2014. The Forest Inventory and Analysis Database: Database description and user guide version 6.0.1 for Phase 3. U.S. Department of Agriculture, Forest Service. 182 p. [Online]. Available: http://www.fia.fs.fed.us/library/database‐documentation/.

```

FIA has a robust data documentation that is unfortunately in a PDF form BUT it is also fairly structured.
This document is an attempt to create a data annotations from this PDF.

Annotations will only be pulled for three tables covering the soil sample physio-chemistry, depth, colleciton date, and geo-location.

```{r}
#FIADB User Guide P2 (v 09.2023)
#Chapter 8 address soil tables (SUBP_SOIL_SAMPLE_LOC and SUBP_SOIL_SAMPLE_LAYER) pages 461-466 and 467-475
#State codes are in Appendix B pgs 813-815 with county codes pgs 816-936
#Locations can be pulled from the PLOT table pg 63-81

dataDictionary &lt;- pdf_text(dataDictionary_pdf)

#print(dataDictionary[461])
temp &lt;- tibble(text = str_extract(dataDictionary[461], 
            pattern = regex('8\\.1\\.1.*(?=\n\n\n\nFIA)', dotall = TRUE, multiline = TRUE) )) %&gt;%
  separate_longer_delim(text, delim = regex('\n (?=8)')) %&gt;%
  separate_wider_delim(cols = text,
                      names = c('Subsection', 'Column name (attribute)', 'Descriptive name', 'Oracle data'),
                       delim = regex(' {2,}'),
                      too_few = "debug", too_many = 'merge')
#TODO Need to clean up two line cells

print(dataDictionary[462])

temp &lt;- tibble(text = str_extract(dataDictionary[462], 
            pattern = regex('8\\.1\\.1.*(?=\n\n\n\n)', dotall = TRUE, multiline = TRUE) )) %&gt;%
  separate_longer_delim(text, delim = regex('\n\n +(?=8\\.1\\.\\d)', dotall = TRUE, multiline = TRUE)) %&gt;%
  mutate(id = str_extract(text, '^8.1.\\d'),
         column_name = trimws(str_extract(text, '(?&lt;=8.1.\\d).*\n')),
         long_name = trimws(str_extract(text, '(?&lt;=\n)[^\\.]+.')),
         description = str_remove(text, '^8.1.\\d[^\\.]+.')) %&gt;%
  mutate(across(.cols = everything(), .fns = trimws))

## Extract the text first, then paste the pages together, then parse the sections
temp2 &lt;- tibble(text = paste(str_extract(dataDictionary[463:466], 
            pattern = regex('(?&lt;=\n{3}).*(?=\n\n\n\n)', dotall = TRUE, multiline = TRUE) ), collapse = '')) %&gt;%
  separate_longer_delim(text, delim = regex('\n\n +(?=8\\.1\\.\\d)', dotall = TRUE, multiline = TRUE)) %&gt;%
  mutate(text = trimws(text)) %&gt;%
  mutate(id = str_extract(text, '^8.1.\\d+'),
         column_name = trimws(str_extract(text, '(?&lt;=8.1.\\d.).*\n')),
         long_name = trimws(str_extract(text, '(?&lt;=\n)[^\\.]+.')),
         description = str_remove(text, '^8.1.\\d+[^\\.]+.')) %&gt;%
  mutate(across(.cols = everything(), .fns = trimws))

sample_loc.data_annotations &lt;- temp %&gt;%
  bind_rows(temp2) %&gt;%
  mutate(table_name = 'SUBP_SOIL_SAMPLE_LOC')

sample_layer.data_annotations &lt;- tibble(text = paste(str_extract(dataDictionary[469:475], 
             pattern = regex('(?&lt;=\n{3}).*(?=\n\n\n\n)', dotall = TRUE, multiline = TRUE) ), collapse = '')) %&gt;%
  separate_longer_delim(text, delim = regex('\n\n +(?=8\\.2\\.\\d)', dotall = TRUE, multiline = TRUE)) %&gt;%
  mutate(text = trimws(text)) %&gt;%
  mutate(id = str_extract(text, '^8.2.\\d+'),
         column_name = trimws(str_extract(text, '(?&lt;=8.2.\\d.).*\n')),
         long_name = trimws(str_extract(text, '(?&lt;=\n)[^\\.]+.')),
         description = str_remove(text, '^8.2.\\d+[^\\.]+.')) %&gt;%
  mutate(across(.cols = everything(), .fns = trimws))

```

```{r}
state_codes &lt;- tibble(pages = dataDictionary[813:814]) %&gt;%
  mutate( pages = str_remove(string = pages,
                             pattern = regex('\n{4,}.*FIA Database Description.*\n$', multiline = TRUE))) %&gt;%
  mutate(pages = str_remove(string = pages, 
                            patter = regex('^.*Station code\n', multiline = TRUE, dotall=TRUE))) %&gt;%
  separate_longer_delim(col = pages, delim = '\n') %&gt;%
  separate_wider_delim(cols = pages, delim = regex('\\s{2,}'), names = c('State', 'State code', 'State abbreviation', 'Research station', 'Region or Station code'), too_few = 'align_start') %&gt;%
  mutate(State = case_when(State == " Federated States of" ~ 'Federated States of Micronesia',
                           State == ' Northern Mariana' ~ 'Northern Mariana Islands',
                           TRUE ~ State)) %&gt;%
  filter(! is.na(`State code`)) %&gt;%
  mutate(across(everything(), trimws))

#create the control vocabulary for the data annotations
paste(sprintf('%s|%s', state_codes$`State code`, state_codes$`State`), collapse = ';')
```

```{r eval=FALSE}
#Appendix G: Forest Inventory and Analysis (FIA) Plot Design Codes and Definitions by FIA Work Unit
#pages 981-986

# columns span multiple rows so it's challening to parse, spitting out the text and then formatting it into a tribble string. This is long so surpressing the next chunk of code
cat(dataDictionary[981:986])
```

```{r echo=FALSE, eval=FALSE}
appendixG &lt;- tribble(~`FIA Work Unit`, ~`Plot Design code (DESIGNCD)`, ~Definition,
 '^a NRS-NE,^b NRS-NC,^c SRS,^d RMRS, ^e PNWRS', '1', 'National plot design consists of four 24-foot fixed-radius subplots for trees 5 inches d.b.h., and four 6.8-foot fixed-radius microplots for seedlings and trees 1 and &lt;5 inches d.b.h. Subplot 1 is the center plot, and subplots 2, 3, and 4 are located 120.0 feet, horizontal, at azimuths of 360, 120, and 240, respectively. The microplot center is 12 feet east of the subplot center. Four 58.9-foot fixed-radius macroplots are optional. A plot may sample more than one condition. When multiple conditions are encountered, condition boundaries are delineated (mapped).',
 '^a NRS-NE', '101', 'Various plot designs. Converted from Eastwide Database format, some fields may be null.',
'^a NRS-NE', '111', 'Four-subplot design similar to DESIGNCD 1, except the microplot for seedlings is 1/1000 acre (3.7-foot radius). If the plot is used for growth estimates, it is overlaid on a 5 subplot design, where remeasurement of trees (5 inches) is on subplot 1 only. Poletimber-sized trees remeasured on a 24-foot radius plot, sawtimber-sized trees remeasured on a 49-foot radius plot. If the plot is not used for growth estimates, it is an initial plot establishment.',
'^a NRS-NE', '112', 'DESIGNCD 111, except that if the plot is used for growth estimates, the remeasurement of trees (5 inches) is on the 24-foot-radius subplot 1 only, regardless of tree size or previous plot size or type (varied).',
'^a NRS-NE', '113', 'DESIGNCD 111, except that if the plot is used for growth estimates, the remeasurement of trees (5 inches) is on the 24-foot-radius subplot 1 only, regardless of tree size or previous plot size or type (single subplot 1/5 acre).',
'^a NRS-NE', '115', 'DESIGNCD 1. Overlaid on a FHM 4-subplot plot design. These plots are not used in change estimates.',
'^a NRS-NE', '116', 'DESIGNCD 1. Overlaid on 1/5 acre plot for all trees 5 inches d.b.h. (1/5 acre plot was an initial measurement). Remeasurement of subplot 1 is only on the 24-foot-radius plot for all trees (5 inches), regardless of tree size or previous plot size.',
'^a NRS-NE', '117', 'DESIGNCD 1. Overlaid on 1/5 acre plot for all trees 5 inches d.b.h. (1/5 acre plot was remeasurement). Remeasurement of subplot 1 is only on the 24-foot-radius plot for all trees (5 inches), regardless of tree size or previous plot size.',
'^a NRS-NE', '118', 'DESIGNCD 1. Overlaid on 10-subplot, variable-radius design. Remeasurement of trees (5 inches) on 5 of the 10 subplots; ingrowth based on trees (5 inches) that grew onto five 6.8-foot radius subplots.',
'^b NRS-NC', '301', 'Various plot designs. Converted from Eastwide Database format, some fields may be null.',
'^b NRS-NC', '311', 'Four-subplot design similar to DESIGNCD 1, except the 1/24 acre and 1/300 acre plots have common centers. Conditions are mapped and boundaries may be within the plots.',
'^b NRS-NC', '312', 'DESIGNCD 1. Initial plot establishment.',
'^b NRS-NC', '313', 'DESIGNCD 311. Overlaid on previous plots, no remeasurements.',
'^b NRS-NC', '314', 'DESIGNCD 1. Overlaid on previous plots, no remeasurements',
'^b NRS-NC', '315', 'DESIGNCD 311. Overlaid on same design. Only trees 5 inches d.b.h. are remeasured.',
'^b NRS-NC', '316', 'DESIGNCD 1. Overlaid on DESIGNCD 311. Only trees 5 inches d.b.h. are remeasured.',
'^b NRS-NC', '317', 'DESIGNCD 1. Overlaid on DESIGNCD 326. Only the first 5 points (trees 5 inches d.b.h.) and first 3, 1/300 acre plots (trees 1 and &lt;5 inches d.b.h.) are remeasured, but conditions were not re-mapped.',
'^b NRS-NC', '318', 'DESIGNCD 311. Overlaid on DESIGNCD 325. Only the first 5 points (trees 5 inches d.b.h.) and first 3, 1/300 acre plots (trees 1 and &lt;5 inches d.b.h.) are remeasured.',
'^b NRS-NC', '319', 'DESIGNCD 1. Overlaid on DESIGNCD 325. Only the first 5 points (trees 5 inches d.b.h.) and first 3, 1/300 acre plots (trees 1 and &lt;5 inches d.b.h.) are remeasured.',
'^b NRS-NC', '320', 'DESIGNCD 311. Overlaid on modified DESIGNCD 325. Only the first 5 points (trees 5 inches d.b.h.) and first 3 1/300 acre plots (trees 1 and &lt;5 inches d.b.h.) are remeasured.',
'^b NRS-NC', '321', 'DESIGNCD 1. Overlaid on modified DESIGNCD 325. Only the first 5 points (trees 5 inches d.b.h.) and first 3 1/300 acre plots (trees 1 and &lt;5 inches d.b.h.) are remeasured.',
'^b NRS-NC', '322', 'DESIGNCD 311. Overlaid on DESIGNCD 327. Only the first 5 points (trees 5 inches d.b.h.) and first 3, 1/300 acre plots (trees 1 and &lt;5 inches d.b.h.) are remeasured.',
'^b NRS-NC', '323', 'DESIGNCD 1. Overlaid on DESIGNCD 327. Only the first 5 points (trees 5 inches d.b.h.) and first 3 1/300 acre plots (trees 1 and &lt;5 inches d.b.h.) are remeasured.',
'^b NRS-NC', '325', 'Ten variable-radius, 37.5 BAF points, 70 feet apart, for trees 5 inches d.b.h. and 10, 1/300 acre plots for seedlings and trees 1 and &lt;5 inches d.b.h. Point and plot center were coincident. Conditions were not mapped. Instead, points were rotated into forest or nonforest based off the condition at point center.',
'^b NRS-NC', '326', 'Ten variable-radius, 37.5 BAF points, 70 feet apart, for trees 5 and &lt;17.0 inches d.b.h., 10 1/24 acre plots for trees 17.0 inches d.b.h., and 10, 1/300 acre plots for seedlings and trees 1 and &lt;5 inches d.b.h. Point and plot center were coincident. Conditions were mapped.',
'^b NRS-NC', '327', 'Ten variable-radius, 37.5 BAF points, 70 feet apart, for trees 5 inches d.b.h. and 10, 1/300 acre plots for seedlings and trees 1 and &lt;5 inches d.b.h. Point and plot center were coincident. Conditions were not mapped. Instead, points were rotated into forest or nonforest based on the condition at point center. Diameters were estimated with a model, but all dead and cut trees were recorded.',
'^b NRS-NC', '328', 'DESIGNCD 1. Overlaid on DESIGNCD 311. All trees and saplings are remeasured.',
'^c SRS', '210', 'Other plot design installed by previous research stations within the 13-State Southern area not described by DESIGNCD 211-219.',
'^c SRS', '211', 'Ten variable-radius, 37.5 BAF points, 70 feet apart. Remeasure first 3 points of same design or new/replacement plot.',
'^c SRS', '212', 'Five variable-radius, 37.5 BAF points, 70 feet apart. Remeasure first 5 points of DESIGNCD 211 or new/replacement plot.',
'^c SRS', '213', 'Five variable-radius, 37.5 BAF points, 70 feet apart. Remeasure DESIGNCD 212.',
'^c SRS', '214', 'Ten variable-radius, 37.5 BAF points, 66 feet apart. Remeasure same design or new/replacement plot.',
'^c SRS', '215', 'Five variable-radius, 37.5 BAF points, 66 feet apart. Remeasure first 5 points of DESIGNCD 214 or new/replacement plot.',
'^c SRS', '216', 'Ten variable-radius, 37.5 BAF points, 66 feet apart. Remeasure DESIGNCD 215.',
'^c SRS', '217', 'Five point cluster plot, point 1 is 1/5th acre sawtimber plot and 1/10th acre poletimber plot, points 2-5 are 37.5 BAF prism points. No remeasurement.',
'^c SRS', '218', 'Remeasurement of DESIGNCD 217, point 1 only. Used only for change estimates.',
'^c SRS', '219', 'Three point, 2.5 BAF metric prism plot, points 25 meters apart. Remeasure same design or new/replacement plot.',
'^c SRS', '220', 'Four 1/24 acre plots for trees 5 inches d.b.h. and 4, 1/300 acre plots for seedlings and trees 1 and &lt;5 inches d.b.h. The 1/24 acre and 1/300 acre plots have common centers. Conditions are mapped and boundaries may be within the plots. Remeasurement plot not described by 221-229.',
'^c SRS', '221', 'DESIGNCD 220. Remeasure same design or new/replacement plot.',
'^c SRS', '222', 'DESIGNCD 220. Overlaid on and remeasurement of DESIGNCD 212 or 213.',
'^c SRS', '223', 'DESIGNCD 220. Overlaid on and remeasurement of first 5 points of DESIGNCD 214 or 216.',
'^c SRS', '230', 'DESIGNCD 1. Remeasurement plot not described by DESIGNCD 231-239.',
'^c SRS', '231', 'DESIGNCD 1. Overlaid on and remeasurement of DESIGNCD 212 or DESIGNCD 213.',
'^c SRS', '232', 'DESIGNCD 1. Overlaid on and remeasurement of first 5 points of DESIGNCD 214 or 216.',
 '^c SRS', '233', 'DESIGNCD 1. Overlaid on and remeasurement of DESIGNCD 220, 221, 222, or 223.',
 '^c SRS', '240', 'DESIGNCD 1. Collected in metric and converted to English in the database. Remeasurement not described by 241-249.',
 '^c SRS', '241', 'DESIGNCD 1. Collected in metric and converted to English in the database. Remeasure same design or new/replacement plot.',
 '^c SRS', '242', 'DESIGNCD 1. Overlaid on and remeasurement of DESIGNCD 219. Collected in metric and converted to English in the database.',
 '^c SRS', '299', 'Other plot design not described in DESIGNCD 200-298.',
 '^d RMRS', '403', 'One 1/10th acre fixed-radius plot divided into 4 quadrants and four 1/300th acre fixed-radius microplots. Timber and woodland tree species &lt;5.0 inches d.r.c. tallied on microplot.',
 '^d RMRS', '404', 'One 1/20th acre fixed-radius plot divided into 4 quadrants and four 1/300th acre fixed-radius microplots. Timber and woodland tree species &lt;5.0 inches d.r.c. tallied on microplot.',
 '^d RMRS', '405', 'One 1/5th acre fixed-radius plot divided into 4 quadrants and four 1/300th acre fixed-radius microplots. Timber and woodland tree species &lt;5.0 inches d.r.c. tallied on microplot.',
 '^d RMRS', '410', '40 BAF variable-radius plots and 1/300th acre fixed-radius microplots; number of microplots = number of points installed. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '411', '40 BAF variable-radius plots and 1/300th acre fixed-radius microplots; 3 microplots installed on points 1, 2, and 3. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '412', '40 BAF variable-radius plots and 1/300th acre fixed-radius microplots; 3 microplots installed on points 1, 2, and 5. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '413', '20 BAF variable-radius plots and 1/300th acre fixed-radius microplots; number of microplots = number of points installed. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '414', '20 BAF variable-radius plots and 1/300th acre fixed-radius microplots; 3 microplots installed on points 1, 2, and 3. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '415', '20 BAF variable-radius plots and 1/300th acre fixed-radius microplots; 3 microplots installed on points 1, 2, and 5. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '420', 'One 1/10th acre fixed-radius plot and one centered 1/100th acre microplot. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '421', 'One 1/20th acre fixed-radius plot and one centered 1/100th acre microplot. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '422', 'One 1/5th acre fixed-radius plot and one centered 1/100th acre microplot. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '423', 'One 1/10th acre fixed-radius plot divided into 4 quadrants and four 1/300th acre fixed-radius microplots. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '424', 'One 1/20th acre fixed-radius plot divided into 4 quadrants and four 1/300th acre fixed-radius microplots. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^d RMRS', '425', 'One 1/5th acre fixed-radius plot divided into 4 quadrants and four 1/300th acre fixed-radius microplots. Timber tree species &lt;5.0 inches d.b.h.; woodland tree species &lt;3.0 inches d.r.c. measured on microplot.',
 '^e PNWRS', '501', 'DESIGNCD 1 with optional macroplot. Trees 24 inches d.b.h. are tallied on macroplot.',
 '^e PNWRS', '502', 'DESIGNCD 1 with optional macroplot. Trees 30 inches d.b.h. are tallied on macroplot.',
 '^e PNWRS', '503', 'DESIGNCD 1 with optional macroplot. Trees 4 inches d.b.h. are tallied on macroplot. Trees 32 inches d.b.h. are tallied on one 1-hectare plot.',
 '^e PNWRS', '504', 'DESIGNCD 1 with optional macroplot. Trees 24 inches d.b.h. are tallied, on macroplot. Trees 48 inches d.b.h. are tallied on one 1-hectare plot.',
 '^e PNWRS', '505', 'DESIGNCD 1 with optional macroplot. Trees 30 inches d.b.h. are tallied on macroplot. Trees 48 inches d.b.h. are tallied on one 1-hectare plot.',
 '^e PNWRS', '506', 'DESIGNCD 1 using larger microplots. Each microplot has a radius of 9.6 feet. Eight 20x50cm microquadrats are established on each subplot for ground layer protocols.',
 '^e PNWRS', '550', 'Five 30.5 BAF points for trees 5 inches and &lt;35.4 inches d.b.h.; five 55.8 foot fixed-radius plots for trees 35.4 inches d.b.h.; and five 7.7-foot fixed-radius plots for seedlings and saplings &lt;5 inches d.b.h. Point and plot centers are coincident. Conditions are mapped.',
 '^e PNWRS', '551', 'Five 20 BAF points for trees 5 inches and &lt;35.4 inches d.b.h.; five 55.6 foot fixed-radius plots for trees 35.4 inches d.b.h.; and five 9.7-foot fixed-radius plots for seedlings and saplings &lt;5 inches d.b.h. Point and plot centers are coincident. Conditions are mapped.',
 '^e PNWRS', '552', 'Five 30 BAF points for trees 5 inches and &lt;35.4 inches d.b.h.; five 55.6-foot fixed-radius plots for trees 35.4 inches d.b.h.; and five 7.9-foot fixed-radius plots for seedlings and saplings &lt;5 inches d.b.h. Point and plot centers are coincident. Conditions are mapped.',
 '^e PNWRS', '553', 'Four 1/24 acre plots for live trees and four 58.9-foot fixed-radius plots for trees 11.8 inches d.b.h. Plot centers are coincident. Conditions are mapped.',
 '^e PNWRS', '554', 'Four 1/24 acre plots for live trees and four 58.9-foot fixed-radius plots for trees 19.7 inches d.b.h. Plot centers are coincident. Conditions are mapped.',
 '^e PNWRS', '555', 'Five 30.5 BAF points for trees 6.9 inches and &lt;35.4 inches d.b.h.; five 55.8-foot fixed-radius plots for trees 35.4 inches d.b.h.; and five 10.8-foot fixed-radius plots for seedlings and saplings &lt;6.9 inches d.b.h. Point and plot centers are coincident. Conditions are mapped.',
 '^e PNWRS', '556', 'Five 30.5 BAF points for trees 6.9 inches and &lt;35.4 inches d.b.h.; five 55.8-foot fixed-radius plots for trees 35.4 inches d.b.h.; five 10.8-foot fixed-radius plots for saplings 5 inches and &lt;6.9 inches d.b.h.; and the northeast quadrant of each of the five 10.8-foot fixed-radius plots for trees &lt;5 inches d.b.h. Point and plot centers are coincident. Conditions are not mapped.',
 '^e PNWRS', '557', 'Five 40 BAF points for trees 5 inches d.b.h.; and five 6.9-foot fixed-radius plots for saplings 1 and &lt;5 inches d.b.h. Point and plot centers are coincident. Conditions are not mapped.',
 '^e PNWRS', '558', 'Three 30.5 BAF points for trees 6.9 inches and &lt;35.4 inches d.b.h.; three 55.8-foot fixed-radius plots for trees 35.4 inches d.b.h.; three 10.8-foot fixed-radius plots for saplings 5 inches and &lt;6.9 inches d.b.h.; and the northeast quadrant of each of the three 10.8-foot fixed-radius plots for trees &lt;5 inches d.b.h. Point and plot centers are coincident. Conditions are mapped, only condition class 1 measured. Overlaid on and remeasurement of same design.',
 '^e PNWRS', '559', 'Four 40 BAF points for trees 5 inches d.b.h.; and four 6.9-foot fixed-radius plots for saplings 1 and &lt;5 inches d.b.h. Point and plot centers are coincident. Conditions are mapped, only condition class 1 measured. Overlaid on and remeasurement of same design.',
 '^e PNWRS', '601', 'South East Coastal Alaska periodic grid plot design. Similar to DESIGNCD 1 with exceptions including: subplots are 7.3 m (23.95 foot) fixed-radius; the four microplots are 2.0 m (6.56 foot) fixed-radius and are centered on each subplot; subplots 2, 3, and 4 are spaced 36.6 m (120.08 feet) from subplot 1, at azimuths of 360, 120, and 240, respectively; condition classes are based on forest stand origin, forest stand size, and forest density in 10% classes; not all annual attributes were collected and additional non-annual attributes were collected.',
 '^e PNWRS', '602', 'South Central Coastal Alaska periodic grid plot design, similar to DESIGNCD 601 except for variations in annual and non-annual attributes collected.',
 '^e PNWRS', '603', 'South Central Coastal Alaska periodic grid plot design for Kodiak and Afognak islands. Similar to DESIGNCD 602 except for reduced (one quarter) sampling intensity.',
 '^a NRS-NE, ^b NRS-NC, ^c SRS, ^d RMRS, ^e PNWRS', '999', 'A plot record created to represent reserved or other nonsampled or undersampled areas where there were no ground plots; the plot has no design type; rather, it is a placeholder for area estimates. In all cases where DESIGNCD 999 plots are present, they are only used for estimates of area; they are not used in estimates of numbers of trees, volume or change (e.g., tree-level estimates).')

knitr::kable(appendixG)
```

```{r}
testingRead &lt;- read_csv('../data/fia_annotations.csv')
```</code></pre>
</div>
</div>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="http://localhost:6116/#next-steps" style="font: 1em / 1 anchorjs-icons; margin-left: 0.1875em; padding-right: 0.1875em; padding-left: 0.1875em;"></a></h2>
<p><em>After you generate the data annotations, what’s next?</em></p>
<p>After you wrote the code that generated the annotations CSV file you must store both the code and annotations file in the appropriate places within the GitHub repository. The code goes into vignettes &gt; articles &gt; Report_{NAME OF YOUR DATA SET}. Toward the end of that file, copy the code into a chuck (or chucks) for documentation purposes. The annotations file must be stored under data &gt; test. This is the file that will be used later for the read function of the corresponding data set.</p>
<p>For what to do once this entire data annotations process is complete, read the <code>How-to Read Functions</code> guide (found in the Wiki) next.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->





<script>window.backupDefine = window.define; window.define = undefined;</script>
<script type="text/javascript" src="./How-to Annotations HTML_files/quarto-preview.js.download"></script>
<script>window.define = window.backupDefine; window.backupDefine = undefined;</script>
<script type="text/javascript">
  const options = {
    origin: "",
    search: "",
    inputFile: "C:\Users\gthra\Coding\Research Lab - Summer 2024\How-To Annotations\SoilDRaH\vignettes\articles\How-to Annotations.qmd",
    isPresentation: false
  }
  document.addEventListener("DOMContentLoaded", function () {
    window.QuartoPreview.init(options);
  });
</script>
<div><div dir="ltr" class="fui-FluentProvider fui-FluentProviderr0 ___jdtuxv0 f19n0e5 fxugw4r f1o700av fk6fouc fkhj508 figsok6 f1i3iumi"></div></div><div id="hl-aria-live-message-container" aria-live="polite" class="visually-hidden"></div><div id="hl-aria-live-alert-container" role="alert" aria-live="assertive" class="visually-hidden"></div><i tabindex="0" role="none" data-tabster-dummy="" aria-hidden="true" style="position: fixed; height: 1px; width: 1px; opacity: 0.001; z-index: -1; content-visibility: hidden; top: 0px; left: 0px;"></i></body></html>
